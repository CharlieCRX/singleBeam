## AD5932手册简略

### 🧩 AD5932 引脚功能简明清单

| 引脚号 | 名称          | 类型     | 主要功能                       | 备注                                                      |
| ------ | ------------- | -------- | ------------------------------ | --------------------------------------------------------- |
| **1**  | **COMP**      | 模拟     | DAC 偏置电压去耦               | 接一个电容到 AVDD                                         |
| **2**  | **AVDD**      | 电源     | 模拟电源（2.3~5.5 V）          | 加 0.1 µF 去耦电容到 AGND                                 |
| **3**  | **DVDD**      | 电源     | 数字电源（2.3~5.5 V）          | 加 0.1 µF 去耦电容到 DGND                                 |
| **4**  | **CAP/2.5V**  | 电源     | 内部 2.5 V 稳压输出            | 典型接 100 nF 电容到 DGND；若 DVDD ≤ 2.7 V，可短接到 DVDD |
| **5**  | **DGND**      | 地       | 数字地                         | 与 AGND 分开布线后单点连接                                |
| **6**  | **MCLK**      | 输入     | 主时钟输入                     | 决定输出频率与相位噪声                                    |
| **7**  | **SYNCOUT**   | 输出     | 扫描状态输出（EOS 或步进信号） | 需设 SYNCOUTEN=1 启用                                     |
| **8**  | **MSBOUT**    | 输出     | DAC 数据的反向 MSB             | 需设 MSBOUTEN=1 启用                                      |
| **9**  | **INTERRUPT** | 输入     | 扫描中断信号                   | 低→高触发，输出回到中值                                   |
| **10** | **CTRL**      | 输入     | 控制启动/初始化/外部步进       | 低→高触发动作，模式由寄存器决定                           |
| **11** | **SDATA**     | 输入     | 串行数据输入                   | 先地址，后数据（MSB→LSB）                                 |
| **12** | **SCLK**      | 输入     | 串行时钟输入                   | 数据在下降沿采样                                          |
| **13** | **FSYNC**     | 输入     | 帧同步信号（低有效）           | 拉低表示开始发送新字                                      |
| **14** | **STANDBY**   | 输入     | 省电模式（高有效）             | 高电平：关闭 MCLK/DAC/稳压器                              |
| **15** | **AGND**      | 地       | 模拟地                         | 建议与 DGND 单点连接                                      |
| **16** | **VOUT**      | 模拟输出 | 模拟输出信号端                 | 内部 200 Ω 负载，推荐加 20 pF 到 AGND                     |

### 🧭 AD5932 Control Register 位定义（简明版）

| 位号        | 名称             | 功能描述                                                     | 可选值                     |
| ----------- | ---------------- | ------------------------------------------------------------ | -------------------------- |
| **D15–D12** | **ADDR**         | 寄存器地址（4 位）                                           | 参考表 5（写入不同寄存器） |
| **D11**     | **B24**          | 频率寄存器写入方式选择：1 = 一次写入完整 24 位（连续两次写入 LSB→MSB）；0 = 分别操作高/低 12 位寄存器 | 0 / 1                      |
| **D10**     | **DAC ENABLE**   | DAC 使能：1 = 启用 DAC 输出；0 = 关闭 DAC（仅输出 MSBOUT 信号） | 0 / 1                      |
| **D9**      | **SINE/TRI**     | 输出波形类型：1 = 正弦波（经 ROM 转换）；0 = 三角波（绕过 ROM） | 0 / 1                      |
| **D8**      | **MSBOUTEN**     | MSBOUT 引脚输出控制：1 = 输出 MSB；0 = 高阻态                | 0 / 1                      |
| **D7**      | —                | **保留位，必须置 1**                                         | 固定为 1                   |
| **D6**      | —                | **保留位，必须置 1**                                         | 固定为 1                   |
| **D5**      | **INT/EXT INCR** | 频率步进触发源：1 = 外部触发（CTRL 引脚）；0 = 自动步进      | 0 / 1                      |
| **D4**      | —                | **保留位，必须置 1**                                         | 固定为 1                   |
| **D3**      | **SYNCSEL**      | SYNCOUT 输出模式（仅当 D2=1 时有效）：1 = 扫描结束输出高电平（EOS 模式）；0 = 每次步进输出脉冲（4×TCLOCK） | 0 / 1                      |
| **D2**      | **SYNCOUTEN**    | SYNCOUT 引脚使能：1 = 输出有效；0 = 高阻态                   | 0 / 1                      |
| **D1**      | —                | **保留位，必须置 1**                                         | 固定为 1                   |
| **D0**      | —                | **保留位，必须置 1**                                         | 固定为 1                   |

## 时间间隔计算

对于 AD5932 的扫频参数中，有一项较为难理解：时间间隔计算。这里详细理解下如何设置每段频率维持输出的时长。

### 🧩一、tINT 是什么

- 每当 AD5932 输出一个频率，它会维持一段时间；
- 到了时间之后，它自动切换到下一个频率；
- 这个“维持多久”就是由 tINT 控制的。

### 🧱 二、寄存器结构

`tINT` 寄存器是一个 16 位的值（15:0），具体位定义如下：

| 位号    | 含义             | 说明                                             |
| ------- | ---------------- | ------------------------------------------------ |
| D15–D14 | 固定 = `01`      | 表示这是一个“Increment Interval”寄存器           |
| D13     | 选择时间计数模式 | `0`: 基于输出波形周期数；`1`: 基于 MCLK 周期数   |
| D12–D11 | 时间基准乘数选择 | 决定“每个基本时间间隔”的长度（详见下表）         |
| D10–D0  | 11 位二进制值    | 表示要等待多少个“基本间隔”后切换频率（最小为 2） |

### ⏱ 三、时间计算逻辑

我们先定义几个核心变量：

- **MCLK**：主时钟频率（例如 50 MHz）
- **TBASE**：基础时间间隔 = (1 / MCLK) × Multiplier
- **interval**：D[10:0] 编程值（2~2047）
- **TINT**：单个频率持续时间 = TBASE × interval

### 🧮 示例一：D13=1（按 MCLK 计时）

| D12 D11 | Multiplier | 说明           | 结果（MCLK=50MHz） |
| ------- | ---------- | -------------- | ------------------ |
| 00      | ×1         | 原始 MCLK 周期 | 1 / 50 MHz = 20 ns |
| 01      | ×5         | 放大 5 倍      | 100 ns             |
| 10      | ×100       | 放大 100 倍    | 2 µs               |
| 11      | ×500       | 放大 500 倍    | 10 µs              |

那么这样我们就可以计算出当 MCLK = 50 MHz 的时候，每个频率持续时间的长度范围：

1. 单个时间间隔为 1/ MCLK = 20 ns
2. 最小的 TBASE = 20ns ×1 × 2 = 40 ns
3. 最大的 TBASE = 20ns × 500 × 2047 ≈  20.5 ms

### 🧮 示例二：D13=0（按输出波周期计时）

在这种模式下，时间不是按时钟周期算，而是按“输出波的周期数”算。

- 如果输出波频率为 fOUT，
- 那么持续时间 = Ncycles × (1 / fOUT)。

即：

$TINT = \text{interval} \times \frac{1}{f_{\text{OUT}}}$

例如：

- 输出波频率 = 1 kHz
- interval = 100 → 输出持续时间 = 100 × (1/1000) = 0.1 s

### 🧭 四、关键区别总结

| 模式  | 控制方式         | 特点                           | 适合场景                             |
| ----- | ---------------- | ------------------------------ | ------------------------------------ |
| D13=0 | 基于输出波周期数 | 每个频率输出固定个数的波形周期 | 频率随输出自动变化时想保持波形数一致 |
| D13=1 | 基于 MCLK 周期数 | 每个频率输出固定的时间         | 精确控制时间、与频率无关             |

## 引脚读写

需要通过读写 FPGA 寄存器的方式，来实现 AD5932 的引脚读写。具体对应为：

- `0x10`：CTRL引脚
- `0x11`：INTERUPT引脚。只能打断 DAC 输出的模拟波，不能打断 MSBOUT
- `0x12`：STANDBY引脚。作为SYNCOUT - STANDBY 关联
- `0x13`：输出引脚 SYNCOUT